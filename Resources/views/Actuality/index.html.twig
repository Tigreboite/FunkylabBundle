{# Generated by Tigreboite\FunkylabBundle 2015-12-10 03:29:09 #}
{% extends 'TigreboiteFunkylabBundle::layout.html.twig' %}

{% block action %}
     <a class="btn btn-default btn-lg" href="#" data-toggle="modal" data-url="{{ path('admin_actuality_new') }}">
        <i class="fa fa-plus"></i> Ajouter une page
    </a>
{% endblock %}

{% block content -%}
    <div class="box-body table-responsive no-padding">
        <table id="table_admin" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Titre</th>
                    <th>Categorie</th>
                    <th>Tags</th>
                    <th>Publié</th>
                    <th>Mise en avant</th>
                    <th>Url</th>
                    <th>Date pulication</th>
                    <th>Création</th>
                    <th>Mise à jour</th>
                    <th class="action"></th>
                </tr>
            </thead>
        </table>
    </div>
{% endblock %}

{% block js %}
<script type="text/javascript">

    $('document').ready(function()
    {
        table = $('#table_admin').DataTable( {
            "processing": true,
            "serverSide": true,
            "autoWidth":true,
            "ajax": Routing.generate('admin_actuality_list'),
            "aoColumns": [
                { "sName": "title" },
                { "sName": "category" },
                { "sName": "tags" },
                { "sName": "published" },
                { "sName": "mea" },
                { "sName": "slug" },
                { "sName": "dateStart" },
                { "sName": "createdAt" },
                { "sName": "updatedAt" },
                { "sName": "_action" }
            ],
            "columnDefs": [ {
                "targets": -1,
                "data": null,
                'bSortable': false, 'aTargets': [ 1 ],
                "defaultContent": '' +
                '<div class="btn-group">'+
                    '<button type="button" class="btn btn-default">Action</button>'+
                    '<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">'+
                        '<span class="caret"></span>'+
                        '<span class="sr-only">Toggle Dropdown</span>'+
                    '</button>'+
                    '<ul class="dropdown-menu" role="menu">'+
                        '<li>'+
                        '   <a class="btn-view" href="#" target="_blank">' +
                        '       <i class="fa fa-eye"></i>Voir' +
                        '   </a>' +
                        '</li>'+
                        '<li>'+
                        '   <a class="btn-editblock" href="#">' +
                        '       <i class="fa fa-plus-square-o"></i>Blocs' +
                        '   </a>' +
                        '</li>'+
                        '<li>'+
                        '   <a class="btn-edit" href="#" data-toggle="modal" data-url="">' +
                        '       <i class="fa fa-edit"></i>Editer' +
                        '   </a>' +
                        '</li>'+
                        '<li>'+
                        '   <a class="btn-remove" href="#" data-url="admin_advice_delete">' +
                        '       <i class="fa fa-trash"></i>Effacer' +
                        '   </a> ' +
                        '</li>'+
                    '</ul>'+
                '</div>'
            }],
            "oLanguage": {
                "sProcessing": "<img src='/bundles/tigreboitefunkylab/images/ajax-loader.gif'>"
            },
            "fnDrawCallback": function( oSettings ) {
              updateModalBtn();
            },
            "fnCreatedRow": function( nRow, aData, iDataIndex ) {

                var url_view = Routing.generate('actuality_page', {slug:aData[aData.length-5],category:aData[1]});
                $(nRow).find('td:last .btn-view').attr('href', url_view);

                var url_update = Routing.generate('admin_actuality_edit', {id:aData[aData.length-1]});
                $(nRow).find('td:last .btn-edit').attr('data-url', url_update);

                var url_bloc = Routing.generate('admin_bloc', {id:aData[aData.length-1],type:"actuality"});
                $(nRow).find('td:last .btn-editblock').attr('href', url_bloc);
            }
        });

        // BTN EVENT
        $('#table_admin tbody').on( 'click', '.btn-remove', function (e) {
            e.preventDefault();
            var data = table.row( $(this).parents('tr') ).data();
            var id_line = data[data.length-1];

            $.confirm({
                text: "Êtes-vous sûr de vouloir supprimer cet élément ? Cela implique la suppression de toute ses références et de ses blocs.",
                confirm: function(button) {
                    $.ajax({
                        url: Routing.generate('admin_actuality_delete', {id:id_line}),
                        method: 'DELETE',
                        success: function(msg){
                            table.draw();
                        }
                    });
                }
            });
        });

    });
</script>
{% endblock %}
